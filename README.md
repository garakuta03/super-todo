# Super TODO

シンプルで使いやすいタスク管理アプリケーション

## 技術スタック

- **Vue 3** (Composition API)
- **TypeScript**
- **Vite**
- **Tailwind CSS**
- **Pinia** (状態管理)
- **Radix Vue** (UIコンポーネント)
- **Firebase** (Authentication / Firestore / Analytics / Hosting)

## 実装済み機能

### 認証機能
✅ Google認証によるログイン/ログアウト
✅ 認証状態の管理と表示
✅ 新規ユーザーの自動初期化
✅ ユーザープロファイル管理
✅ **ユーザー設定機能**
  - デフォルトリストの設定（ログイン時に自動選択）
  - ユーザー情報の表示

### 階層構造によるタスク管理
✅ **4階層の組織構造**
  - ワークスペース（組織レベル）
  - プロジェクト
  - TODOリスト
  - TODO（タスク）
✅ 左サイドバーナビゲーション
✅ ワークスペース・プロジェクト・リストの切り替え

### タスク管理
✅ タスクの作成・編集・削除
✅ タスク名の編集
✅ タスクの完了/未完了の切り替え
✅ タスク詳細パネル（説明の編集、ステータス変更）
✅ リスト別タスク管理
✅ **開始日・期日の設定**
  - カレンダーUIで視覚的に日付を選択
  - クイックアクション（今日・明日・今週末・月末）
  - 時刻入力フィールド
  - タスク詳細パネルとタスク作成モーダルから設定可能
✅ **ドラッグ&ドロップによるタスク並び替え**
  - タスク左側の `⋮⋮` アイコンをドラッグして並び替え
  - Firestore に自動保存され、リアルタイム同期
  - SortableJS と Vue 3 の統合

### ワークスペース・プロジェクト・リスト管理
✅ **ワークスペース編集・削除機能**
  - ワークスペース名、アイコン（絵文字）、カラーの編集
  - 編集ダイアログから削除可能
✅ **プロジェクト編集・削除機能**
  - プロジェクト名、アイコン（絵文字）、カラーの編集
  - ホバー時に表示される設定アイコンから編集
  - 編集ダイアログから削除可能
✅ **リスト編集・削除機能**
  - リスト名、アイコン（絵文字）、カラーの編集
  - ホバー時に表示される設定アイコンから編集
  - 編集ダイアログから削除可能
✅ **削除確認ダイアログ**
  - すべての削除操作で安全な確認プロセス
  - アイテム名を表示して誤削除を防止

### データ管理
✅ Firestoreによるクラウド同期
✅ リアルタイムデータ更新
✅ **ユーザーIDによる完全なデータ分離**
✅ セキュアなアクセス制御（Firestore Rules）
✅ 複合インデックスによるクエリ最適化

### オンボーディング
✅ 新規ユーザーセットアップ画面
✅ 初回サインアップ時の自動データ生成
  - ユーザープロファイル
  - デフォルトワークスペース
  - デフォルトプロジェクト
  - デフォルトTODOリスト

### 監視・分析
✅ Firebase Analyticsによるエラートラッキング
✅ グローバルエラーハンドラー
✅ 認証エラーのロギング

## 開発開始

### 1. 依存関係のインストール

```bash
npm install
```

### 2. Firebase設定（必須）

このアプリケーションはFirebaseを使用します。以下の手順でセットアップしてください：

#### 2-1. Firebaseプロジェクトの作成

1. [Firebase Console](https://console.firebase.google.com/) にアクセス
2. 新しいプロジェクトを作成
3. 以下の機能を有効化：
   - **Authentication** → Google認証を有効化
   - **Firestore Database** → テストモードで開始
   - **Analytics** → エラートラッキング用

#### 2-2. 環境変数の設定

```bash
cp .env.local.example .env.local
```

`.env.local`を編集して、Firebase Consoleから取得した設定値を入力：

```env
VITE_FIREBASE_API_KEY=your-api-key
VITE_FIREBASE_AUTH_DOMAIN=your-project.firebaseapp.com
VITE_FIREBASE_PROJECT_ID=your-project-id
VITE_FIREBASE_STORAGE_BUCKET=your-project.appspot.com
VITE_FIREBASE_MESSAGING_SENDER_ID=your-sender-id
VITE_FIREBASE_APP_ID=your-app-id
```

Firebase Consoleの「プロジェクトの設定」から上記の値を取得して設定してください。

### 3. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで http://localhost:5173/ にアクセス

### 4. ビルド

```bash
npm run build
```

### 5. プレビュー

```bash
npm run preview
```

## Firebase Hostingへのデプロイ

### 前提条件

Firebase CLIのインストール：

```bash
npm install -g firebase-tools
```

### デプロイ手順

1. Firebaseにログイン：

```bash
firebase login
```

2. Firebaseプロジェクトを初期化（初回のみ）：

```bash
firebase init hosting
```

- 既存のプロジェクトを選択
- public directoryは `dist` を指定
- SPAとして設定: Yes
- GitHubへの自動デプロイ設定: お好みで

3. ビルドとデプロイ：

```bash
npm run build
firebase deploy --only hosting
```

## プロジェクト構成

```
src/
├── components/
│   ├── auth/            # 認証関連コンポーネント
│   │   ├── LoginPage.vue
│   │   └── SetupPage.vue    # 新規ユーザーセットアップ画面
│   ├── layout/          # レイアウトコンポーネント
│   │   ├── MainLayout.vue
│   │   ├── AppHeader.vue
│   │   └── Sidebar.vue      # 左サイドバーナビゲーション
│   ├── workspace/       # ワークスペース関連コンポーネント
│   │   └── WorkspaceEditDialog.vue  # ワークスペース編集ダイアログ
│   ├── project/         # プロジェクト関連コンポーネント
│   │   └── ProjectEditDialog.vue    # プロジェクト編集ダイアログ
│   ├── list/            # リスト関連コンポーネント
│   │   └── ListEditDialog.vue       # リスト編集ダイアログ
│   ├── settings/        # 設定関連コンポーネント
│   │   └── UserSettingsDialog.vue   # ユーザー設定ダイアログ
│   ├── task/            # タスク関連コンポーネント
│   │   ├── TaskRow.vue
│   │   ├── TaskList.vue
│   │   ├── TaskModal.vue
│   │   └── TaskPanel.vue
│   ├── common/          # 共通コンポーネント
│   │   └── DeleteConfirmDialog.vue  # 削除確認ダイアログ
│   └── ui/              # UIコンポーネント
│       ├── button/
│       ├── checkbox/
│       ├── dialog/
│       ├── input/
│       ├── badge/
│       ├── sheet/
│       ├── textarea/
│       ├── popover/
│       ├── DateTimePicker.vue       # 旧日付・時刻ピッカー（互換性のため残存）
│       └── CalendarDatePicker.vue   # カレンダーUI日付ピッカー（v-calendar使用）
├── stores/              # Piniaストア
│   ├── authStore.ts     # 認証状態管理
│   ├── workspaceStore.ts # ワークスペース管理
│   ├── projectStore.ts  # プロジェクト管理
│   ├── listStore.ts     # リスト状態管理
│   └── taskStore.ts     # タスク状態管理
├── lib/                 # ユーティリティ
│   ├── types.ts         # 型定義（Workspace/Project/List/Task/UserProfile）
│   ├── utils.ts         # ユーティリティ関数
│   ├── validation.ts    # 入力バリデーション
│   ├── firebase.ts      # Firebase初期化・Analytics
│   ├── firestore.ts     # Firestore API
│   └── initializeUser.ts # ユーザー初期化サービス
├── assets/              # スタイル
│   └── main.css
├── App.vue
└── main.ts              # エントリーポイント・エラーハンドラー
```

## 基本的な使い方

### 1. 初回ログイン（新規ユーザー）

1. アプリケーションにアクセス
2. 「Googleでサインイン」ボタンをクリック
3. セットアップ画面で表示名を入力
4. 「始める」ボタンをクリック
5. 自動的に以下が作成されます：
   - ユーザープロファイル
   - デフォルトワークスペース（「〇〇のワークスペース」）
   - デフォルトプロジェクト（「最初のプロジェクト」）
   - デフォルトTODOリスト（「ToDoリスト」）

### 2. ワークスペース・プロジェクトの管理

#### ワークスペースの管理
1. 左サイドバー上部のワークスペース名の横の設定アイコンをクリック
2. ワークスペース名、アイコン（絵文字）、カラーを編集
3. 削除ボタンで不要なワークスペースを削除可能

#### プロジェクトの管理
1. プロジェクト名の隣の「+」ボタンで新しいプロジェクトを作成
2. プロジェクトにホバーすると設定アイコンが表示される
3. 設定アイコンをクリックしてプロジェクト名、アイコン、カラーを編集
4. 削除ボタンで不要なプロジェクトを削除可能

#### リストの管理
1. プロジェクト名の横の「+」アイコンで新しいリストを作成
2. リストにホバーすると設定アイコンとゴミ箱アイコンが表示される
3. 設定アイコンをクリックしてリスト名、アイコン、カラーを編集
4. 削除ボタンで不要なリストを削除可能（確認ダイアログが表示されます）

### 3. タスクを作成

1. 右上の「+ 追加」ボタンをクリック
2. タスク名を入力
3. （オプション）開始日・期日を設定
4. 「追加する」ボタンをクリック
5. タスクは現在選択中のリストに追加されます

### 4. タスクを編集・削除

#### 編集
1. タスクをクリックして詳細パネルを開く
2. タスク名、説明、ステータス、開始日、期日を編集
3. 自動保存されます

#### 開始日・期日の設定
1. タスクの詳細パネルまたはタスク作成モーダルを開く
2. 「開始日」または「期日」のボタンをクリック
3. カレンダーから日付を視覚的に選択
4. またはクイックアクションボタン（今日・明日・今週末・月末）をクリック
5. 時刻入力フィールドで時刻を設定（デフォルト: 00:00）
6. 「決定する」ボタンで確定、「リセットする」ボタンで日付を削除可能

#### 削除
- **方法1**: タスク行にホバーして表示されるゴミ箱アイコンをクリック
- **方法2**: 詳細パネル下部の「タスクを削除」ボタンをクリック
- どちらの方法でも削除確認ダイアログが表示されます

### 5. タスクを並び替え

1. タスク左側の `⋮⋮` アイコンにマウスを乗せる
2. ドラッグして好きな位置に移動
3. ドロップすると自動保存されます

### 6. タスクを完了

タスク左側のチェックボックスをクリック

### 7. デフォルトリストを設定

1. 右上の設定アイコン（歯車）をクリック
2. 「デフォルトリスト」のドロップダウンから任意のリストを選択
3. 「保存」ボタンをクリック
4. 次回ログイン時に、設定したリストが自動的に開きます

### 8. ログアウト

右上のログアウトアイコンをクリック

## 新機能の詳細

### 編集・削除機能

このアプリケーションでは、すべての階層（ワークスペース・プロジェクト・リスト・タスク）で編集・削除機能を提供しています。

#### 編集ダイアログの機能
- **名前の変更**: わかりやすい名前に変更可能
- **アイコンの設定**: 絵文字でビジュアル化（例: 🏢, 📁, 📝）
- **カラーの設定**: カラーコードで色をカスタマイズ（例: #3B82F6）

#### 安全な削除機能
- すべての削除操作で確認ダイアログが表示されます
- 削除するアイテム名が表示され、誤削除を防止
- ホバー時のみ削除ボタンが表示され、UIがすっきり
- 削除後は即座にFirestoreと同期し、リアルタイム更新

## Gitコミット履歴

```bash
git log --oneline
```

全てのコミットメッセージは日本語で記載されています。

## Firebase機能の詳細

### Authentication（認証）
- Googleアカウントでのソーシャルログイン
- 認証状態の永続化
- ユーザー情報の表示（名前、アバター）

### Firestore（データベース）
- タスクデータのクラウド同期
- リアルタイムデータ更新
- オフライン対応

### Analytics（分析）
- アプリケーションエラーの自動収集
- Vue エラーハンドラー統合
- Promise未処理エラーのトラッキング
- カスタムエラーイベントのログ記録

### Hosting（ホスティング）
- 静的サイトホスティング
- 自動HTTPSサポート
- CDN配信

## ドラッグ&ドロップ機能の実装詳細

タスクの並び替え機能は以下の技術を組み合わせて実装されています：

### 使用ライブラリ
- **SortableJS**: ドラッグ&ドロップUIライブラリ
- **@vueuse/integrations**: Vue 3用のSortableJS統合

### 実装のポイント

1. **常時レンダリング**: ドラッグ&ドロップのコンテナとなるDOM要素は常に存在する必要があります。条件付きレンダリング（v-if）でコンテナが再作成されるとSortableJSのバインディングが壊れるため、コンテナは常にレンダリングします。

2. **手動配列操作**: `useSortable`はDOM操作を行いますが、Vue のリアクティブ配列は自動更新されません。そのため、`onEnd`イベントで手動で配列を並び替えます：
   ```typescript
   const currentOrder = [...sortableTasks.value]
   const [movedTask] = currentOrder.splice(oldIndex, 1)
   currentOrder.splice(newIndex, 0, movedTask)
   ```

3. **Firestore セキュリティルール**: `order`フィールドの更新を許可するため、以下のルールを追加：
   ```javascript
   && (!('order' in request.resource.data) || request.resource.data.order is number)
   ```

4. **リアルタイム同期**: ドラッグ操作後、Firestoreへの保存が完了すると、リアルタイムリスナーによって他のクライアントにも即座に反映されます。

### トラブルシューティング

**症状**: ドラッグしても要素が動かない
**原因**: コンテナ要素が`v-if`で条件付きレンダリングされている
**解決**: コンテナを常にレンダリングし、空状態メッセージのみを`v-if`で表示

**症状**: ドラッグ後に元の位置に戻る
**原因**: Firestoreセキュリティルールで`order`フィールドが拒否されている
**解決**: セキュリティルールに`order`フィールドの検証を追加

## 実装状況

### ✅ 完了した機能

| 機能 | 状態 | 備考 |
|------|------|------|
| プロジェクト初期化 | ✅ | Vue 3 + TypeScript + Vite |
| Tailwind CSS設定 | ✅ | v3.4（安定版） |
| 型定義 | ✅ | Workspace / Project / List / Task / UserProfile |
| Piniaストア | ✅ | authStore / workspaceStore / projectStore / listStore / taskStore |
| 階層構造データモデル | ✅ | Workspace → Project → List → Task |
| 左サイドバーナビゲーション | ✅ | 階層表示・切り替え |
| 基本レイアウト | ✅ | MainLayout / AppHeader / Sidebar |
| タスク一覧表示 | ✅ | TaskList / TaskRow |
| タスク作成モーダル | ✅ | Dialog使用 |
| タスク詳細パネル | ✅ | Sheet使用（右側スライド） |
| チェックボックス | ✅ | 完了/未完了切り替え |
| ドラッグ&ドロップ並び替え | ✅ | SortableJS統合 |
| ワークスペース編集 | ✅ | 名前・アイコン・カラー編集 |
| ワークスペース削除 | ✅ | 削除確認ダイアログ付き |
| プロジェクト編集 | ✅ | 名前・アイコン・カラー編集 |
| プロジェクト削除 | ✅ | 削除確認ダイアログ付き |
| リスト編集 | ✅ | 名前・アイコン・カラー編集 |
| リスト削除 | ✅ | ホバー時削除ボタン・確認ダイアログ |
| タスク削除 | ✅ | 2つの削除方法・確認ダイアログ |
| タスク名編集 | ✅ | 詳細パネルから編集可能 |
| 開始日・期日設定 | ✅ | 日付・時刻ピッカー・クイックアクション |
| ユーザー設定 | ✅ | デフォルトリスト設定 |
| 削除確認ダイアログ | ✅ | 汎用コンポーネント化 |
| パスワードマネージャー対策 | ✅ | 1Password/LastPass自動入力を無効化 |
| 新規ユーザー初期化 | ✅ | セットアップ画面・自動データ生成 |
| Firebase Authentication | ✅ | Google認証 |
| Firebase Firestore | ✅ | クラウド同期・リアルタイム更新 |
| Firestore セキュリティルール | ✅ | ユーザーベースのアクセス制御・入力検証 |
| Firestore インデックス | ✅ | userId複合インデックス最適化 |
| ユーザーデータ分離 | ✅ | 全クエリでuserIdフィルタリング |
| Firebase Analytics | ✅ | エラートラッキング |
| Firebase Hosting | ✅ | 本番デプロイ完了 |

### 📋 改善候補・今後のタスク

#### UIの改善
- [ ] レスポンシブデザインの最適化
- [ ] ダークモード対応
- [ ] ローディング状態の改善
- [ ] アニメーション効果の追加

#### 機能の追加
- [x] ワークスペース編集・削除機能
- [x] プロジェクト編集・削除機能
- [x] リスト編集・削除機能
- [x] タスク削除機能（タスク行・詳細パネル）
- [x] タスク名編集機能
- [x] タスクの並び替え（ドラッグ&ドロップ）
- [x] ユーザー設定（デフォルトリスト）
- [x] 開始日・期日の設定
- [ ] **繰り返しタスク機能** 🔄
  - テンプレート＋自動生成方式を推奨
  - Phase 1: 基本機能（毎日/毎週/毎月、終了日設定）
  - Phase 2: 拡張機能（曜日指定、間隔指定、履歴表示）
  - 実装案の詳細は Issue を参照
- [ ] フィルター・検索機能
- [ ] タグ機能
- [ ] サブタスク機能
- [ ] 期限リマインダー
- [ ] ワークスペースへの招待機能
- [ ] チーム共同作業機能

#### セキュリティ・パフォーマンス
- [ ] コード分割による初期ロード時間の改善
- [ ] 画像最適化
- [ ] PWA対応（オフライン機能の強化）
- [x] インデックス最適化（Firestore）

#### 開発体験
- [ ] テストコードの追加
- [ ] CI/CD パイプラインの構築
- [ ] エラーバウンダリの実装
- [ ] アクセシビリティの改善

## トラブルシューティング

### 認証エラーが発生する場合

1. Firebase Consoleで認証プロバイダーが有効になっているか確認
2. `.env.local`の設定値が正しいか確認
3. ブラウザのサードパーティCookieが有効になっているか確認

### Tailwind CSSが適用されない場合

1. ブラウザでハードリロード: `Cmd + Shift + R` (Mac) / `Ctrl + Shift + R` (Windows)
2. 開発サーバーを再起動: `npm run dev`
3. `node_modules`を削除して再インストール:
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```

### エラーログを確認したい場合

Firebase Console → Analytics → イベント → `exception`イベントを確認

### 新規ユーザーとしてテストしたい場合

1. 別のGoogleアカウントでログイン
2. または、Firebase Console → Authentication → Users から既存ユーザーを削除
3. Firestore Consoleから該当ユーザーのデータ（users/workspaces/projects/lists/tasks）を削除

## デモ

本番環境: https://todo-3d4c8.web.app

## ライセンス

MIT
